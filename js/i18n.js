class I18n {
    constructor() {
        this.translations = {
            de: {
                app: {
                    title: 'Audio Guide'
                },
                nav: {
                    home: 'Start',
                    artworks: 'Alle Kunstwerke',
                    help: 'Hilfe',
                    about: 'Über',
                    previous: 'Vorheriges',
                    next: 'Nächstes',
                    browse: 'Kunstwerke durchsuchen'
                },
                input: {
                    clear: 'Löschen',
                    scan: 'QR-Code scannen',
                    cancelScan: 'Scan abbrechen',
                    placeholder: 'Nummer eingeben'
                },
                help: {
                    title: 'Hilfe & Anleitung',
                    getting_started: 'Erste Schritte',
                    intro: 'Willkommen beim Audio Guide! Diese Anleitung hilft Ihnen, durch die Kunstwerksammlung zu navigieren und die verfügbaren Funktionen optimal zu nutzen.',
                    access_ways: 'Zugriffsmöglichkeiten',
                    keypad: {
                        title: 'Nummern-Eingabe',
                        desc: 'Tippen Sie einfach auf das Eingabefeld und verwenden Sie das Tastenfeld, um die Kunstwerk-Nummer einzugeben.'
                    },
                    qr: {
                        title: 'QR-Code Scanner',
                        desc: 'Nutzen Sie die QR-Scanner-Taste, um die QR-Codes der Kunstwerke für schnellen Zugriff zu scannen.'
                    },
                    gallery: {
                        title: 'Galerie-Ansicht',
                        desc: 'Durchstöbern Sie alle Kunstwerke in der Galerieansicht und klicken Sie auf ein Kunstwerk, um Details anzuzeigen.'
                    },
                    audio: {
                        title: 'Audio-Player Funktionen',
                        controls: {
                            title: 'Wiedergabesteuerung',
                            desc: 'Spielen Sie ab, pausieren Sie und navigieren Sie durch den Audio-Inhalt mit den Player-Bedienelementen.'
                        },
                        language: {
                            title: 'Sprachauswahl',
                            desc: 'Wechseln Sie jederzeit zwischen den verfügbaren Sprachen mit der Sprachauswahl.'
                        }
                    },
                    images: {
                        title: 'Bildergalerie',
                        desc: 'Betrachten Sie mehrere Bilder jedes Kunstwerks mit dem Bildslider. Nutzen Sie die Pfeile oder wischen Sie zum Navigieren.'
                    },
                    accessibility: {
                        title: 'Barrierefreiheit',
                        theme: {
                            title: 'Dunkelmodus',
                            desc: 'Wechseln Sie zwischen hellem und dunklem Design für angenehmes Betrachten in jeder Umgebung.'
                        },
                        text: {
                            title: 'Klarer Text',
                            desc: 'Große, gut lesbare Schrift und kontrastreiche Farben für bessere Sichtbarkeit.'
                        }
                    }
                },
                about: {
                    title: 'Über den Audio Guide',
                    project: {
                        title: 'Über das Projekt',
                        intro: 'Willkommen bei unserem modernen Audio Guide System! Dieser digitale Guide wurde entwickelt, um Ihr Kunsterlebnis mit detaillierten Audiobeschreibungen und visuellen Inhalten in mehreren Sprachen zu bereichern.'
                    },
                    features: {
                        title: 'Hauptfunktionen',
                        multilingual: {
                            title: 'Mehrsprachige Unterstützung',
                            desc: 'Volle Unterstützung für Deutsch und Englisch, mit professionell aufgenommenen Audioinhalten in beiden Sprachen.'
                        },
                        responsive: {
                            title: 'Mobile-First Design',
                            desc: 'Optimiert für alle Geräte mit einer intuitiven, touch-freundlichen Benutzeroberfläche.'
                        },
                        offline: {
                            title: 'Offline-Fähigkeit',
                            desc: 'Funktioniert ohne Internetverbindung nach dem Laden, perfekt für Galerieumgebungen.'
                        }
                    },
                    accessibility: {
                        title: 'Barrierefreiheit',
                        intro: 'Unser Audio Guide wurde mit Fokus auf Barrierefreiheit entwickelt und bietet:',
                        contrast: {
                            title: 'Hoher Kontrast',
                            desc: 'Helle und dunkle Designs für optimale Lesbarkeit bei allen Lichtverhältnissen.'
                        },
                        audio: {
                            title: 'Klarer Ton',
                            desc: 'Hochwertige Audioaufnahmen mit klarer Erzählung und einstellbarer Lautstärke.'
                        }
                    },
                    tech: {
                        title: 'Technische Details',
                        pwa: {
                            title: 'Progressive Web App',
                            desc: 'Kann auf Ihrem Gerät für schnellen Zugriff und Offline-Nutzung installiert werden.'
                        },
                        security: {
                            title: 'Datenschutz im Fokus',
                            desc: 'Keine Sammlung persönlicher Daten, alles läuft lokal auf Ihrem Gerät.'
                        }
                    },
                    credits: {
                        title: 'Danksagung',
                        text: 'Dieser Audio Guide wurde mit Sorgfalt und Liebe zum Detail entwickelt. Besonderer Dank gilt allen Mitwirkenden, die dieses Projekt ermöglicht haben.'
                    },
                    version: {
                        label: 'Version',
                        number: '1.0.0'
                    }
                }
            },
            en: {
                app: {
                    title: 'Audio Guide'
                },
                nav: {
                    home: 'Home',
                    artworks: 'All Artworks',
                    help: 'Help',
                    about: 'About',
                    previous: 'Previous',
                    next: 'Next',
                    browse: 'Browse Artworks'
                },
                input: {
                    clear: 'Clear',
                    scan: 'Scan QR Code',
                    cancelScan: 'Cancel Scan',
                    placeholder: 'Enter number'
                },
                help: {
                    title: 'Help & Instructions',
                    getting_started: 'Getting Started',
                    intro: 'Welcome to the Audio Guide! This guide will help you navigate through the artwork collection and make the most of the available features.',
                    access_ways: 'Ways to Access Artworks',
                    keypad: {
                        title: 'Number Input',
                        desc: 'Simply tap the input field and use the keypad to enter the artwork number.'
                    },
                    qr: {
                        title: 'QR Code Scanner',
                        desc: 'Use the QR scanner button to scan artwork QR codes for quick access.'
                    },
                    gallery: {
                        title: 'Gallery View',
                        desc: 'Browse all artworks in the gallery view and click on any artwork to view details.'
                    },
                    audio: {
                        title: 'Audio Player Features',
                        controls: {
                            title: 'Playback Controls',
                            desc: 'Play, pause, and navigate through the audio content using the player controls.'
                        },
                        language: {
                            title: 'Language Selection',
                            desc: 'Switch between available languages at any time using the language selector.'
                        }
                    },
                    images: {
                        title: 'Image Gallery',
                        desc: 'View multiple images of each artwork using the image slider. Use arrows or swipe to navigate.'
                    },
                    accessibility: {
                        title: 'Accessibility',
                        theme: {
                            title: 'Dark Mode',
                            desc: 'Toggle between light and dark themes for comfortable viewing in any environment.'
                        },
                        text: {
                            title: 'Clear Text',
                            desc: 'Large, readable text and high contrast colors for better visibility.'
                        }
                    }
                },
                about: {
                    title: 'About the Audio Guide',
                    project: {
                        title: 'About the Project',
                        intro: 'Welcome to our modern Audio Guide system! This digital guide has been designed to enhance your art viewing experience with detailed audio descriptions and visual content in multiple languages.'
                    },
                    features: {
                        title: 'Key Features',
                        multilingual: {
                            title: 'Multilingual Support',
                            desc: 'Full support for German and English, with professionally recorded audio in both languages.'
                        },
                        responsive: {
                            title: 'Mobile-First Design',
                            desc: 'Optimized for all devices with an intuitive, touch-friendly interface.'
                        },
                        offline: {
                            title: 'Offline Capability',
                            desc: 'Works without internet connection once loaded, perfect for gallery environments.'
                        }
                    },
                    accessibility: {
                        title: 'Accessibility',
                        intro: 'Our audio guide is designed with accessibility in mind, featuring:',
                        contrast: {
                            title: 'High Contrast Mode',
                            desc: 'Light and dark themes for optimal readability in any lighting condition.'
                        },
                        audio: {
                            title: 'Clear Audio',
                            desc: 'High-quality audio recordings with clear narration and adjustable volume.'
                        }
                    },
                    tech: {
                        title: 'Technical Details',
                        pwa: {
                            title: 'Progressive Web App',
                            desc: 'Can be installed on your device for quick access and offline use.'
                        },
                        security: {
                            title: 'Privacy Focused',
                            desc: 'No personal data collection, everything runs locally on your device.'
                        }
                    },
                    credits: {
                        title: 'Credits',
                        text: 'This audio guide was developed with care and attention to detail. Special thanks to all contributors who made this project possible.'
                    },
                    version: {
                        label: 'Version',
                        number: '1.0.0'
                    }
                }
            }
        };

        this.currentLang = this.getInitialLanguage();
        this.initLanguageSelector();
        this.translate();
    }

    getInitialLanguage() {
        // Check localStorage first
        const storedLang = localStorage.getItem('preferred_language');
        if (storedLang && this.translations[storedLang]) {
            return storedLang;
        }

        // Check browser language
        const browserLang = navigator.language.split('-')[0];
        if (this.translations[browserLang]) {
            return browserLang;
        }

        // Default to German
        return 'de';
    }

    initLanguageSelector() {
        const langButtons = document.querySelectorAll('.lang-btn');
        langButtons.forEach(btn => {
            if (btn.dataset.lang === this.currentLang) {
                btn.classList.add('active');
            }
            btn.addEventListener('click', () => this.setLanguage(btn.dataset.lang));
        });
    }

    setLanguage(lang) {
        if (this.translations[lang]) {
            this.currentLang = lang;
            localStorage.setItem('preferred_language', lang);
            this.translate();
            
            // Update active state of language buttons
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === lang);
            });

            // Update HTML lang attribute
            document.documentElement.lang = lang;

            // Dispatch language change event that bubbles up to window
            window.dispatchEvent(new CustomEvent('languageChanged', {
                bubbles: true,
                detail: { language: lang }
            }));
        }
    }

    translate() {
        document.querySelectorAll('[data-i18n]').forEach(element => {
            const key = element.dataset.i18n;
            const translation = this.getTranslation(key);
            if (translation) {
                if (element.tagName === 'INPUT' && element.type === 'number') {
                    element.placeholder = translation;
                } else {
                    element.textContent = translation;
                }
            }
        });
    }

    getTranslation(key) {
        return key.split('.').reduce((obj, i) => obj ? obj[i] : null, this.translations[this.currentLang]);
    }
}

// Initialize i18n when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    window.i18n = new I18n();
}); 